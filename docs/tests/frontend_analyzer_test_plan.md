# Plano de Teste: Frontend do Analisador de Documentos

## 1. Introdução

### 1.1. Objetivo
Este documento detalha o plano de testes para o módulo "Analisador de Documentos" do frontend da aplicação. O objetivo é garantir a qualidade, funcionalidade e usabilidade dos componentes de upload de documentos, feedback de processamento e interface de chat.

### 1.2. Escopo
O escopo deste plano de teste cobre:
- Testes de componentes individuais.
- Testes de integração entre componentes e o store Zustand (`analisadorStore.ts`).
- Cenários de teste End-to-End (E2E) para o fluxo completo do usuário.

Não estão no escopo (a menos que especificado):
- Testes de performance detalhados.
- Testes de segurança aprofundados (além da verificação básica de chamadas autenticadas).
- Testes de compatibilidade exaustiva entre todos os navegadores e dispositivos (foco nos navegadores modernos mais comuns).

### 1.3. Ferramentas Sugeridas
- **Testes de Componentes e Integração:** Jest com React Testing Library (RTL).
- **Testes End-to-End (E2E):** Playwright ou Cypress.
- **Mocking de API:** `msw` (Mock Service Worker) ou mocks manuais do Jest.

## 2. Testes de Componentes

### 2.1. Upload de Documentos

**Componentes Alvo:** `frontend/src/modules/analisador_documentos/components/DocumentUploadForm.tsx`, `frontend/src/modules/analisador_documentos/stores/analisadorStore.ts`, `frontend/src/services/api.ts` (função `uploadDocumentForAnalysis`)

**Casos de Teste:**

| ID      | Descrição                                                                 | Passos                                                                                                                                                              | Resultado Esperado                                                                                                                                |
|---------|---------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------|
| TC_DU_01 | Renderização inicial do formulário de upload.                               | 1. Renderizar `DocumentUploadForm`.                                                                                                                                | Componente é renderizado contendo um input de arquivo e um botão de upload. Botão inicialmente habilitado (se nenhum upload em progresso).          |
| TC_DU_02 | Seleção de um arquivo válido.                                               | 1. Renderizar `DocumentUploadForm`.<br>2. Simular seleção de um arquivo PDF mock.                                                                                    | O nome do arquivo selecionado é exibido (se houver UI para isso) ou o estado interno do componente reflete a seleção.                               |
| TC_DU_03 | Submissão do formulário com arquivo válido.                                 | 1. Renderizar `DocumentUploadForm`.<br>2. Selecionar arquivo mock.<br>3. Simular clique no botão "Upload".<br>4. Mockar `uploadDocumentForAnalysis` para sucesso. | A action `setUploading` do `analisadorStore` é chamada.<br>A API `uploadDocumentForAnalysis` é chamada com o arquivo correto.<br>A action `setUploadSuccess` do store é chamada com o `taskId` retornado. |
| TC_DU_04 | Botão de upload desabilitado durante o envio.                             | 1. Renderizar `DocumentUploadForm`.<br>2. Selecionar arquivo.<br>3. Clicar em "Upload".<br>4. Mockar `uploadDocumentForAnalysis` para demorar.                      | O botão de upload e o input de arquivo ficam desabilitados enquanto `analisadorStore.status` é 'uploading'.                                          |
| TC_DU_05 | Falha no upload do arquivo (erro de API).                                 | 1. Renderizar `DocumentUploadForm`.<br>2. Selecionar arquivo.<br>3. Clicar em "Upload".<br>4. Mockar `uploadDocumentForAnalysis` para falha.                   | Mensagem de erro apropriada é exibida ao usuário.<br>`analisadorStore.status` vai para 'error' e `errorMessage` é populado.<br>Botão de upload reabilitado. |
| TC_DU_06 | Tentativa de upload sem selecionar arquivo.                               | 1. Renderizar `DocumentUploadForm`.<br>2. Clicar em "Upload" sem selecionar arquivo.                                                                                | Nenhuma chamada à API é feita. Mensagem de erro/aviso pode ser exibida (dependendo da UI).                                                          |

### 2.2. Feedback de Processamento

**Componentes Alvo:** `frontend/src/modules/analisador_documentos/components/ProcessingStatusIndicator.tsx`, `frontend/src/modules/analisador_documentos/stores/analisadorStore.ts`, `frontend/src/services/api.ts` (função `getDocumentProcessingStatus`)

**Casos de Teste:**

| ID      | Descrição                                                                 | Passos                                                                                                                               | Resultado Esperado                                                                                                                                                  |
|---------|---------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| TC_PF_01 | Exibição de status 'idle'.                                                | 1. Configurar `analisadorStore` para status 'idle'.<br>2. Renderizar `ProcessingStatusIndicator`.                                          | Nenhuma mensagem de status específica ou progresso é exibida, ou uma mensagem padrão "Aguardando upload".                                                       |
| TC_PF_02 | Exibição de status 'uploading'.                                           | 1. Configurar `analisadorStore` para status 'uploading', `statusMessage` "Enviando...".<br>2. Renderizar `ProcessingStatusIndicator`.         | Mensagem "Enviando..." e indicador de progresso (possivelmente indeterminado ou em 0%) são exibidos.                                                               |
| TC_PF_03 | Exibição de status 'queued'/'processing' com mensagem e progresso.        | 1. Configurar `analisadorStore` para status 'processing', `statusMessage` "Processando página 5/10", `progress` 50.<br>2. Renderizar `ProcessingStatusIndicator`. | Mensagem "Processando página 5/10" e barra de progresso em 50% são exibidos.                                                                                      |
| TC_PF_04 | Exibição de status 'success'.                                             | 1. Configurar `analisadorStore` para status 'success', `statusMessage` "Processamento concluído!", `progress` 100.<br>2. Renderizar `ProcessingStatusIndicator`. | Mensagem "Processamento concluído!" e barra de progresso em 100% são exibidos. `processedDocumentId` deve estar populado no store.                                |
| TC_PF_05 | Exibição de status 'error'.                                               | 1. Configurar `analisadorStore` para status 'error', `errorMessage` "Falha no OCR".<br>2. Renderizar `ProcessingStatusIndicator`.             | Mensagem de erro "Falha no OCR" é exibida (e.g., Alert). Nenhuma mensagem de status normal.                                                                          |
| TC_PF_06 | Lógica de Polling: Transição de status.                                   | 1. Iniciar upload (TC_DU_03).<br>2. Mockar `getDocumentProcessingStatus` para retornar 'QUEUED', depois 'PROCESSING', depois 'SUCCESS'.      | `ProcessingStatusIndicator` reflete as mudanças de status e mensagens conforme o store é atualizado pelo polling. Polling para ao atingir 'SUCCESS'.               |
| TC_PF_07 | Lógica de Polling: Parada em caso de erro.                                | 1. Iniciar upload (TC_DU_03).<br>2. Mockar `getDocumentProcessingStatus` para retornar 'QUEUED', depois 'FAILURE'.                           | `ProcessingStatusIndicator` reflete as mudanças de status e, finalmente, o erro. Polling para ao atingir 'FAILURE'.                                             |

### 2.3. Interface de Chat

**Componentes Alvo:** `frontend/src/pages/AnalisadorDocumentosPage.tsx` (seção do chat), `frontend/src/services/api.ts` (função `postDocumentQuery`), `analisadorStore.ts` (para `processedDocumentId` e `docStatus`)

**Casos de Teste:**

| ID      | Descrição                                                                  | Passos                                                                                                                                                                                            | Resultado Esperado                                                                                                                                                                  |
|---------|----------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| TC_CI_01 | Renderização inicial da interface de chat.                                   | 1. Configurar `analisadorStore` com `processedDocumentId` nulo.<br>2. Renderizar `AnalisadorDocumentosPage`.                                                                                         | Interface de chat (input, botão, área de mensagens) é renderizada. Input e botão de enviar estão desabilitados. Tooltip/placeholder informa sobre a necessidade de processar um doc. |
| TC_CI_02 | Habilitação do chat após processamento bem-sucedido.                         | 1. Configurar `analisadorStore` com `docStatus` 'success' e `processedDocumentId` válido.<br>2. Renderizar `AnalisadorDocumentosPage`.                                                                 | Input de chat e botão de enviar estão habilitados.                                                                                                                                      |
| TC_CI_03 | Envio de mensagem pelo usuário.                                              | 1. Simular TC_CI_02.<br>2. Digitar "Qual o tema principal?" no input.<br>3. Clicar em "Enviar".<br>4. Mockar `postDocumentQuery` para sucesso.                                                          | Mensagem "Qual o tema principal?" aparece na área de chat (remetente: usuário).<br>API `postDocumentQuery` é chamada com o `processedDocumentId` e o texto.<br>Input é limpo.        |
| TC_CI_04 | Exibição da resposta da IA.                                                  | 1. Simular TC_CI_03.<br>2. Mockar `postDocumentQuery` para retornar `{ answer: "O tema é IA." }`.                                                                                                    | Mensagem "O tema é IA." aparece na área de chat (remetente: IA) após a mensagem do usuário.                                                                                          |
| TC_CI_05 | Botão de enviar desabilitado durante o envio da pergunta.                    | 1. Simular TC_CI_02.<br>2. Digitar mensagem.<br>3. Clicar em "Enviar".<br>4. Mockar `postDocumentQuery` para demorar.                                                                                   | Botão de enviar e input ficam desabilitados enquanto `isSending` é true.                                                                                                            |
| TC_CI_06 | Falha ao enviar pergunta (erro de API).                                      | 1. Simular TC_CI_02.<br>2. Digitar mensagem.<br>3. Clicar em "Enviar".<br>4. Mockar `postDocumentQuery` para falha.                                                                                   | Mensagem de erro da IA (e.g., "Desculpe, não consegui processar.") aparece na área de chat.<br>Botão de enviar reabilitado.                                                         |
| TC_CI_07 | Envio de mensagem pressionando Enter.                                        | 1. Simular TC_CI_02.<br>2. Digitar "Qual o tema principal?" no input.<br>3. Pressionar Enter.<br>4. Mockar `postDocumentQuery` para sucesso.                                                             | Comportamento similar ao TC_CI_03 e TC_CI_04.                                                                                                                                       |
| TC_CI_08 | Tentativa de envio de mensagem vazia.                                        | 1. Simular TC_CI_02.<br>2. Não digitar nada no input.<br>3. Clicar em "Enviar" ou pressionar Enter.                                                                                                 | Nenhuma mensagem é enviada. Nenhuma chamada à API. Botão pode estar desabilitado.                                                                                                   |

## 3. Cenários de Teste End-to-End (E2E)

Estes cenários devem ser executados em um ambiente de teste que simule o mais próximo possível o ambiente de produção, com backend e frontend integrados (APIs podem ser mockadas no nível da rede se necessário com Playwright/Cypress).

| ID       | Descrição                                                                 | Passos                                                                                                                                                                                                                                                                                                                                                                                       | Resultado Esperado                                                                                                                                                                                                                                                                                                                                                                                                                    |
|----------|---------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| E2E_01   | Fluxo completo bem-sucedido (Upload, Processamento, Chat).                | 1. Navegar para a página "Analisador de Documentos".<br>2. Fazer upload de um arquivo PDF de teste.<br>3. (Mock API de upload) Verificar feedback de "uploading".<br>4. (Mock API de status) Verificar feedback de "queued", "processing" (com atualizações de progresso/mensagem), e finalmente "success".<br>5. Verificar se a interface de chat está habilitada.<br>6. Enviar uma pergunta no chat.<br>7. (Mock API de query) Verificar se a pergunta do usuário e a resposta da IA aparecem corretamente. | Todas as etapas são concluídas com sucesso. O usuário consegue interagir com o documento processado via chat.                                                                                                                                                                                                                                                                                                                           |
| E2E_02   | Falha no upload do documento.                                             | 1. Navegar para a página "Analisador de Documentos".<br>2. Tentar fazer upload de um arquivo.<br>3. (Mock API de upload para retornar erro).                                                                                                                                                                                                                                                        | Mensagem de erro de upload é exibida. Interface de chat permanece desabilitada.                                                                                                                                                                                                                                                                                                                                                       |
| E2E_03   | Falha no processamento do documento.                                      | 1. Navegar para a página "Analisador de Documentos".<br>2. Fazer upload de um arquivo PDF.<br>3. (Mock API de upload para sucesso).<br>4. (Mock API de status para eventualmente retornar "FAILURE").                                                                                                                                                                                                | Feedback de upload OK, depois feedback de processamento, e finalmente mensagem de erro de processamento é exibida. Interface de chat permanece desabilitada.                                                                                                                                                                                                                                                                      |
| E2E_04   | Falha na interação com o chat.                                            | 1. Simular E2E_01 até o chat estar habilitado.<br>2. Enviar uma pergunta no chat.<br>3. (Mock API de query para retornar erro).                                                                                                                                                                                                                                                                      | Pergunta do usuário aparece no chat. Mensagem de erro da IA (ou mensagem genérica de falha no chat) é exibida.                                                                                                                                                                                                                                                                                                                         |
| E2E_05   | Navegação e estado persistente (se aplicável).                            | 1. Realizar E2E_01.<br>2. Navegar para outra página do sistema.<br>3. Navegar de volta para "Analisador de Documentos".                                                                                                                                                                                                                                                                          | O estado anterior do Analisador (documento processado, histórico de chat, se desejado) é mantido ou reiniciado conforme o design esperado. (Este teste depende dos requisitos de persistência de estado).                                                                                                                                                                                                                         |

## 4. Considerações Adicionais

-   **Responsividade:** Verificar a usabilidade e layout da interface em diferentes tamanhos de tela (desktop, tablet, mobile).
-   **Acessibilidade (Básica):**
    -   Contraste de cores.
    -   Navegação por teclado.
    -   Atributos ARIA básicos para inputs e botões.
-   **Tratamento de Múltiplos Uploads:** Como a interface se comporta se o usuário tentar fazer upload de um novo documento enquanto um anterior ainda está sendo processado ou um chat está ativo? (Definir comportamento esperado e testar).

## 5. Matriz de Rastreabilidade

(Opcional, mas recomendado para projetos maiores)
Mapear os requisitos funcionais do Analisador de Documentos para os casos de teste correspondentes.

| Requisito ID | Descrição do Requisito                                  | Caso(s) de Teste Relacionado(s) |
|--------------|---------------------------------------------------------|---------------------------------|
| REQ_AD_001   | Permitir upload de documentos PDF.                      | TC_DU_01, TC_DU_02, TC_DU_03    |
| REQ_AD_002   | Exibir feedback visual durante upload e processamento.  | TC_PF_01 a TC_PF_07, E2E_01     |
| REQ_AD_003   | Permitir interação via chat com documento processado.   | TC_CI_01 a TC_CI_08, E2E_01     |
| ...          | ...                                                     | ...                             |
